% Created 2024-05-14 Tue 19:36
% Intended LaTeX compiler: pdflatex
\documentclass[aspectratio=169]{beamer}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage{graphicx}
\usepackage{longtable}
\usepackage{wrapfig}
\usepackage{rotating}
\usepackage[normalem]{ulem}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{capt-of}
\usepackage{hyperref}
\usepackage{appendixnumberbeamer}
\usepackage{amssymb}
\usepackage{tabularx}
\usepackage[ruled]{algorithm2e}             % Algorithms
\usepackage{tikz}                           % Draw stuff
\usetikzlibrary{arrows.meta}                % Arrows for tikz
\usepackage{subcaption}                     % Subfigures
\usepackage{animate}                        % Created animated things
\renewcommand{\arraystretch}{1.5}
\logo{
\begin{tikzpicture}[overlay,remember picture]
\node[left=0.2cm] at (current page.26){
\includegraphics[height=0.5cm]{img/u-state-black.png}
};
\end{tikzpicture}
}
\institute[USU] % (optional)
{
College of Engineering\\
Utah State University
}
\beamertemplatenavigationsymbolsempty
\addtobeamertemplate{navigation symbols}{}{%
\usebeamerfont{footline}%
\usebeamercolor[fg]{footline}%
\hspace{1em}%
\insertframenumber/\inserttotalframenumber
}
\newcommand\mycommfont[1]{\footnotesize\ttfamily\textcolor{gray}{#1}}
\newcommand{\T}{\mathcal{T}}                % To make it clear the difference
\newcommand{\Tau}{T}                        % between Tau and T
\newcommand{\AC}{AC(u, d, v, \eta)}         % Set the parameters for AC once
\newcommand{\UC}{UC(u, d, v)}               % Set the parameters for UC once
\newcommand{\ACi}{AC(u_i, d_i, q_i, \eta_i)}% Set the parameters for AC once
\newcommand{\UCi}{UC(u_i, d_i, q_i)}        % Set the parameters for UC once
\newcommand{\Not}{\textbf{not }}            % Custom `not' operator
\newcommand{\visit}{(i, b, a, e, u, d, q, \eta, \xi)}
\newcommand{\I}{\mathbb{I}}                 % Set of visit tuples
\newcommand{\C}{\mathbb{C}}                 % Charger availability information
\newcommand{\U}{\mathcal{U}}                % Uniform distribution
\newcommand{\W}{\mathcal{W}}                % Weighted distribution
\newcommand{\Sol}{\mathbb{S}}               % A shorthand for visit tuple
\newcommand{\M}{\mathbb{M}}                 % A shorthand for the metadata
\newcommand{\Hd}{\mathbb{H}}                % Set of discrete times
\newcommand{\Nu}{\mathcal{V}}               % Draw a nice Nu
\newcommand{\Iset}{I}                       % Set of visits 1-I
\newcommand{\Isetinit}{I_0}                 % Set of visits inital visits
\newcommand{\Isetfinal}{I_f}                % Set of visits final visits
\newcommand{\Bset}{B}                       % Set of visits 1-B
\newcommand{\Qset}{Q}                       % Set of visits 1-Q
\newcommand{\Jset}{J}                       % Set of visits 1-J
\newcommand{\Jsetq}{\mathbb{J}}             % Set of visits 1-J for queue active times
\newcommand{\Hset}{H}                       % Set of visits 1-H
\usetheme{default}
\usecolortheme{dolphin}
\author{Alexander Brown}
\date{\today}
\title{A SIMULATED ANNEALING APPROACH TO THE BATTERY ELECTRIC BUS CHARGING PROBLEM}
\AtBeginSection[]{
\begin{frame}<beamer>\frametitle{Topic}\tableofcontents[currentsection]\end{frame}
\subsection{}
}
\hypersetup{
 pdfauthor={Alexander Brown},
 pdftitle={A SIMULATED ANNEALING APPROACH TO THE BATTERY ELECTRIC BUS CHARGING PROBLEM},
 pdfkeywords={},
 pdfsubject={},
 pdfcreator={Emacs 29.3 (Org mode 9.6.15)}, 
 pdflang={English}}
\begin{document}

\maketitle
\begin{frame}{Outline}
\tableofcontents
\end{frame}


\section{Introduction}
\label{sec:org25b1047}
\begin{frame}[label={sec:org9c51540}]{Brief State Of The Art}
\begin{center}
\begin{tabularx}{\textwidth}{XXXXXXX}
\hline
Ref & Demand & Consumption & Linear Battery & Non-linear Battery & Charger Minimization & Battery Health\\[0pt]
\hline
\cite{zhou-2020-bi-objec} & \(\checkmark\) &  &  &  &  & \\[0pt]
\cite{whitaker-2023-a-network} & \(\checkmark\) &  &  & \(\checkmark\) &  & \\[0pt]
\cite{zhou-2020-bi-objec} & \(\checkmark\) &  &  &  &  & \\[0pt]
\cite{zhou-2020-collab-optim} & \(\checkmark\) &  &  &  &  & \\[0pt]
\cite{duan-2021-refor-mixed} & \(\checkmark\) &  &  &  &  & \\[0pt]
\cite{rinaldi-2020-mixed-fleet} & \(\checkmark\) &  &  &  &  & \\[0pt]
\cite{jahic-2019-preem} & \(\checkmark\) & \(\checkmark\) & \(\checkmark\) & \(\checkmark\) &  & \\[0pt]
\cite{frendo-2021-open-sourc} & \(\checkmark\) & \(\checkmark\) & \(\checkmark\) &  &  & \\[0pt]
\cite{qin-2016-numer-analy} & \(\checkmark\) & \(\checkmark\) & \(\checkmark\) &  &  & \\[0pt]
\cite{mortensen-2023-cost-minim} & \(\checkmark\) & \(\checkmark\) & \(\checkmark\) &  &  & \\[0pt]
BEB PAP & \(\checkmark\) & \(\checkmark\) & \(\checkmark\) &  & \(\checkmark\) & \(\checkmark\)\\[0pt]
SA BEB PAP & \(\checkmark\) & \(\checkmark\) & \(\checkmark\) & \(\checkmark\) & ? & \(\checkmark\)\\[0pt]
\hline
\end{tabularx}
\end{center}
\end{frame}

\begin{frame}[label={sec:orgae659e9}]{Problem Description}
\begin{center}
\includegraphics[width=0.55\textwidth]{./img/visit.pdf}
\end{center}
\end{frame}

\begin{frame}[label={sec:org7569b33}]{The Berth Allocation Problem\footnote{\url{https://www.mdpi.com/2077-1312/11/7/1280}}}
\begin{center}
\includegraphics[width=0.8\textwidth]{./img/berthing-sky-picture.png}
\end{center}
\end{frame}

\begin{frame}[label={sec:org2f8e2d3}]{The Berth Allocation Problem}
\begin{columns}
\begin{column}{0.4\columnwidth}
\begin{itemize}
\item Vessels move down toward the quay
\item Receive service
\item Exit to the right
\end{itemize}

\noindent\rule{\textwidth}{0.5pt}
\begin{itemize}
\item A variant of the rectangle packing problem
\item Solves the problem of optimally assigning incoming vessels to be serviced
\end{itemize}
\end{column}

\begin{column}{0.6\columnwidth}
\begin{center}
\includegraphics[width=0.6\textwidth]{./img/bap.pdf}
\end{center}

\begin{center}
\includegraphics[width=0.5\textwidth]{./img/spatiotemporal-packing.pdf}
\end{center}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[label={sec:orga7c3c16}]{The Position Allocation Problem}
\begin{columns}
\begin{column}{0.5\columnwidth}
\begin{itemize}
\item Service flow is left to right
\item Single charger type
\item All arrivals are considered unique
\item Service times are assumed to be known
\end{itemize}
\end{column}

\begin{column}{0.5\columnwidth}
\begin{center}
\includegraphics[width=0.8\textwidth]{./img/pap.pdf}
\end{center}

\begin{center}
\includegraphics[width=0.7\textwidth]{./img/visit.pdf}
\end{center}
\end{column}
\end{columns}
\end{frame}

\section{The Position Allocation Problem Approach With Linear Battery Dynamic}
\label{sec:org870b818}
\begin{frame}[label={sec:org5671406}]{Requirements For BEB Implementation}
\begin{columns}
\begin{column}{0.6\columnwidth}
\begin{itemize}
\item Charges must be able to be tracked
\item Service time is unknown
\item Accommodate chargers of different speeds
\item Minimize charger count
\item Minimize consumption cost
\item Encourage slow charger use for battery health
\end{itemize}
\end{column}

\begin{column}{0.4\columnwidth}
\begin{center}
\includegraphics[width=0.8\textwidth]{./img/pap.pdf}
\end{center}

\begin{center}
\includegraphics[width=0.7\textwidth]{./img/visit.pdf}
\end{center}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[label={sec:org1bbeb89}]{Constraints}
\begin{equation*}
\label{eq:objective}
	\min \sum_{i=1}^{n_V} \sum_{q=1}^{n_Q} \Big( w_{iq} m_q + g_{iq} \epsilon_q \Big)
\end{equation*}

\begin{columns}
\begin{column}{0.5\columnwidth}
\begin{equation*}
\begin{array}{l}
    u_j - u_i - s_i - (\sigma_{ij} - 1)T \geq 0 \\
    v_j - v_i - (\psi_{ij} - 1)n_Q \geq 1 \\
    \sigma_{ij} + \sigma_{ji} \leq 1 \\
    \psi_{ij} + \psi_{ji} \leq 1 \\
    \sigma_{ij} + \sigma_{ji} + \psi_{ij} + \psi_{ji} \geq 1 \\
    \sum_{q=1}^{n_Q} w_{iq} = 1 \\
    v_i = \sum_{q=1}^{n_Q} qw_{iq} \\
\end{array}
\end{equation*}
\end{column}

\begin{column}{0.5\columnwidth}
\begin{equation*}
\begin{array}{l}
  s_i + u_i = d_i \\
  a_i \leq u_i \leq (T - s_i) \\
  d_i \leq \tau_i \\
  \eta_i + \sum_{q=1}^{n_Q} g_{iq} r_q - \Delta_i = \eta_{\gamma_i} \\
  \eta_i + \sum_{q=1}^{n_Q} g_{iq} r_q - \Delta_i \geq \nu_{\Gamma_i} \kappa_{\Gamma_i} \\
  \eta_i + \sum_{q=1}^{n_Q} g_{iq} r_q \leq \kappa_{\Gamma_i} \\
\end{array}
\end{equation*}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[label={sec:org9d962df}]{Constraints}
\begin{columns}
\begin{column}{0.4\columnwidth}
\begin{equation*}
\begin{array}{l}
    u_j - u_i - s_i - (\sigma_{ij} - 1)T \geq 0 \\
    v_j - v_i - (\psi_{ij} - 1)n_Q \geq 1 \\
    \sigma_{ij} + \sigma_{ji} \leq 1 \\
    \psi_{ij} + \psi_{ji} \leq 1 \\
    \sigma_{ij} + \sigma_{ji} + \psi_{ij} + \psi_{ji} \geq 1 \\
\end{array}
\end{equation*}

\noindent\rule{\textwidth}{0.5pt}

\begin{itemize}
\item Used to ensure that gray rectangles do not overlap
\item \(\sigma_{ij}\) establishes temporal ordering when active
\item \(\psi_{ij}\) establishes spacial ordering when active
\end{itemize}
\end{column}

\begin{column}{0.6\columnwidth}
\begin{figure}
    \centering
    \scalebox{0.4}{
      \centering
        \begin{tikzpicture}
          % Variables
          \def \arrx   {2.0}
          \def \initx  {3.5}
          \def \endx   {8.5}
          \def \depx   {10.0}
          \def \yshift {5}

          % Axis
          \draw [thick,<->] (0,15) node[above]{Queues} -- (0,0) -- (15,0) node[right]{Time};

          % Rectangles
          \node[rectangle, draw, fill=gray, minimum width=4cm, minimum height = 3cm] at (3,12) {A};
          \node[rectangle, draw, fill=gray, minimum width=3cm, minimum height = 3cm] at (9,12) {B};
          \node[rectangle, draw, fill=gray, minimum width=5cm, minimum height = 3cm] at (6,7) {D};
          \node[rectangle, draw, fill=gray, minimum width=6cm, minimum height = 3cm] at (12,2) {C};

          % Y-axis labels
          \node[rotate=90] at (-1, 2.25) {Queue 1};
          \node[rotate=90] at (-1, 7.25) {Queue 2};
          \node[rotate=90] at (-1, 12.25) {Queue 3};

          % Horizontal lines
          \draw[dotted] (0, 4.5) -- (15, 4.5);
          \draw[dotted] (0, 9.5) -- (15, 9.5);

        \end{tikzpicture}
      }
      \label{fig:spacial-and-temporal-constr}
\end{figure}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[label={sec:org83f4d38}]{Parameters}
\begin{columns}
\begin{column}{0.3\columnwidth}
\begin{center}
\begin{tabular}{|l|l|}
Execution & 2 hr\\[0pt]
\(T\) & 24 hr\\[0pt]
\(n_V\) & 338\\[0pt]
\(n_A\) & 35\\[0pt]
\(\alpha_i\) & 90\%\\[0pt]
\(\beta_i\) & 70\%\\[0pt]
\(\nu_i\) & 20\%\\[0pt]
\(\beta_i\) & 70\%\\[0pt]
\(m_q\) & 1000q\\[0pt]
\end{tabular}
\end{center}
\end{column}

\begin{column}{0.7\columnwidth}
\begin{figure}
    \centering
    \scalebox{0.4}{
      \centering
        \begin{tikzpicture}
          % Variables
          \def \arrx   {2.0}
          \def \initx  {3.5}
          \def \endx   {8.5}
          \def \depx   {10.0}
          \def \yshift {5}

          % Axis
          \draw [thick,<->] (0,15) node[above]{Queues} -- (0,0) -- (15,0) node[right]{Time};

          % Rectangles
          \node[rectangle, draw, fill=gray, minimum width=4cm, minimum height = 3cm] at (3,12) {A};
          \node[rectangle, draw, fill=gray, minimum width=3cm, minimum height = 3cm] at (9,12) {B};
          \node[rectangle, draw, fill=gray, minimum width=5cm, minimum height = 3cm] at (6,7) {D};
          \node[rectangle, draw, fill=gray, minimum width=6cm, minimum height = 3cm] at (12,2) {C};

          % Y-axis labels
          \node[rotate=90] at (-1, 2.25) {Queue 1};
          \node[rotate=90] at (-1, 7.25) {Queue 2};
          \node[rotate=90] at (-1, 12.25) {Queue 3};

          \draw[dotted] (0, 4.5) -- (15, 4.5);
          \draw[dotted] (0, 9.5) -- (15, 9.5);

        \end{tikzpicture}
      }
      \label{fig:spacial-and-temporal-constr}
\end{figure}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[label={sec:org8fb4633}]{Schedules}
\begin{columns}
\begin{column}{0.5\columnwidth}
\begin{figure}[htpb]
\centering
    \includegraphics[width=\textwidth]{img/milp-pap/schedule-milp-pap}
\end{figure}

\begin{itemize}
\item Utilized more slow chargers for longer durations
\item Fast chargers utilized more sparingly
\end{itemize}
\end{column}

\begin{column}{0.5\columnwidth}
\begin{figure}[htpb]
\centering
    \includegraphics[width=\textwidth]{img/milp-pap/schedule-qin}
\end{figure}

\begin{itemize}
\item Extensive use of fast chargers
\item Slow chargers used for short durations
\end{itemize}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[label={sec:org423c3f6}]{SOC And Energy Use}
\begin{columns}
\begin{column}{0.5\columnwidth}
\begin{center}
\begin{tabular}{l|cccc}
\hline
 & MILP & Qin\\[0pt]
\hline
Mean & 265.873 & 355.93\\[0pt]
Min & 97.04 & 0.000\\[0pt]
Max & 388 & 368.354\\[0pt]
\hline
\end{tabular}
\end{center}

\begin{itemize}
\item SOC of Qin allowed to drop to 0
\item PAP maintained minimum SOC and final SOC
\end{itemize}
\end{column}

\begin{column}{0.5\columnwidth}
\begin{center}
\includegraphics[width=\textwidth]{./img/milp-pap/energy-milp-pap.pdf}
\end{center}

\begin{itemize}
\item PAP accumulated energy is larger due to minimum SOC constraints
\end{itemize}
\end{column}
\end{columns}
\end{frame}

\section{The Simulated Annealing Approach With Linear Battery Dynamics}
\label{sec:org0dd6a9e}
\begin{frame}[label={sec:org56a5a90}]{Simulated Annealing\footnote{\url{https://en.wikipedia.org/wiki/Simulated\_annealing}}}
\begin{columns}
\begin{column}{0.5\columnwidth}
\begin{itemize}
\item A probabilistic technique for approximating the global optimum of a given function.
\item Often applied to problems that contain many local solutions
\item Three key components:
\begin{itemize}
\item Cooling Schedule
\item Acceptance Criteria
\item Generation Mechanisms
\end{itemize}
\end{itemize}
\end{column}

\begin{column}{0.5\columnwidth}
\centering
\animategraphics[width=0.9\linewidth]{10}{img/tsp/tsp-}{0}{87}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[label={sec:org0758731}]{Cooling Schedule}
\begin{columns}
\begin{column}{0.5\columnwidth}
\begin{itemize}
\item The cooling equation models the rate at which the temperature decreases over time in the SA process.
\item The temperature is high, SA encourages exploration. As the temperature decreases, exploitation is encouraged.
\end{itemize}
\end{column}

\begin{column}{0.5\columnwidth}
\begin{figure}[t!]
  \centering \includegraphics[width=0.9\textwidth]{img/geometric.png}
  \label{fig:geometric}
\end{figure}

\begin{equation*}
t_m = \beta t_{m-1}
\end{equation*}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[label={sec:org9463d1a}]{Acceptance Criteria\footnote{\url{https://en.wikipedia.org/wiki/Simulated\_annealing}}}
\begin{equation*}
\label{eq:candaccept}
f(\mathbb{I},\bar{\mathbb{I}},t_m) =
\begin{cases}
  1                   & \Delta E > 0 \\
  e^{- \frac{\Delta E}{t_m}} & \text{otherwise}
\end{cases}
\end{equation*}

\begin{columns}
\begin{column}{0.7\columnwidth}
\centering
\animategraphics[width=\linewidth]{10}{img/sa-visual/sa-}{0}{274}
\end{column}

\begin{column}{0.3\columnwidth}
\begin{figure}[t!]
  \centering \includegraphics[width=\textwidth]{img/geometric.png}
  \label{fig:geometric}
\end{figure}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[label={sec:org418e246}]{Generation Mechanisms - Primitive Functions}
\begin{columns}
\begin{column}{0.4\columnwidth}
\begin{itemize}
\item New Visit: Move a bus from a wait queue to charge queue
\item Slide Visit: Change the charge duration of a visit
\item New Charger: Move a visit to a new charger
\item Wait: Move a visit to its idle queue
\item New Window: Execute Wait then New Visit primitives
\end{itemize}
\end{column}

\begin{column}{0.6\columnwidth}
\begin{figure}
    \centering
    \scalebox{0.4}{
      \centering
        \begin{tikzpicture}
          % Variables
          \def \arrx   {2.0}
          \def \initx  {3.5}
          \def \endx   {8.5}
          \def \depx   {10.0}
          \def \yshift {5}

          % Axis
          \draw [thick,<->] (0,15) node[above]{Queues} -- (0,0) -- (15,0) node[right]{Time};

          % Rectangles
          \node[rectangle, draw, fill=gray, minimum width=4cm, minimum height = 3cm] at (3,12) {A};
          \node[rectangle, draw, fill=gray, minimum width=3cm, minimum height = 3cm] at (9,12) {B};
          \node[rectangle, draw, fill=gray, minimum width=5cm, minimum height = 3cm] at (6,7) {D};
          \node[rectangle, draw, fill=gray, minimum width=6cm, minimum height = 3cm] at (12,2) {C};

          % Y-axis labels
          \node[rotate=90] at (-1, 2.25) {Queue 1};
          \node[rotate=90] at (-1, 7.25) {Queue 2};
          \node[rotate=90] at (-1, 12.25) {Queue 3};

          % Horizontal lines
          \draw[dotted] (0, 4.5) -- (15, 4.5);
          \draw[dotted] (0, 9.5) -- (15, 9.5);

        \end{tikzpicture}
      }
      \label{fig:spacial-and-temporal-constr}
\end{figure}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[label={sec:org3dfae83}]{Generation Mechanisms - Wrapper Functions}
\begin{columns}
\begin{column}{0.4\columnwidth}
\begin{itemize}
\item Charge Schedule Generation: Iterate through each visit and execute New Visit
\item Perturb Schedule: Randomly execute one of the primitives with a weighted distribution
\end{itemize}
\end{column}

\begin{column}{0.6\columnwidth}
\begin{figure}
    \centering
    \scalebox{0.4}{
      \centering
        \begin{tikzpicture}
          % Variables
          \def \arrx   {2.0}
          \def \initx  {3.5}
          \def \endx   {8.5}
          \def \depx   {10.0}
          \def \yshift {5}

          % Axis
          \draw [thick,<->] (0,15) node[above]{Queues} -- (0,0) -- (15,0) node[right]{Time};

          % Rectangles
          \node[rectangle, draw, fill=gray, minimum width=4cm, minimum height = 3cm] at (3,12) {A};
          \node[rectangle, draw, fill=gray, minimum width=3cm, minimum height = 3cm] at (9,12) {B};
          \node[rectangle, draw, fill=gray, minimum width=5cm, minimum height = 3cm] at (6,7) {D};
          \node[rectangle, draw, fill=gray, minimum width=6cm, minimum height = 3cm] at (12,2) {C};

          % Y-axis labels
          \node[rotate=90] at (-1, 2.25) {Queue 1};
          \node[rotate=90] at (-1, 7.25) {Queue 2};
          \node[rotate=90] at (-1, 12.25) {Queue 3};

          % Horizontal lines
          \draw[dotted] (0, 4.5) -- (15, 4.5);
          \draw[dotted] (0, 9.5) -- (15, 9.5);

        \end{tikzpicture}
      }
      \label{fig:spacial-and-temporal-constr}
\end{figure}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[label={sec:orgbb54a4f}]{Objective Function}
\begin{equation*}
  J(\mathbb{I}) = z_d p_d + \sum_{i=1}^{n_V} \Big[ \epsilon_{q_i}r_{q_i} + z_p \phi_i(\eta_i - \nu_{b_i} \kappa_{b_i}) + z_c r_{q_i} s_i \Big]
\end{equation*}

\begin{columns}
\begin{column}{0.5\columnwidth}
\begin{itemize}
\item Demand cost
\begin{itemize}
\item \(p_{T_p,h} = \frac{1}{T_p} \sum_{k = h-\frac{T_p}{dt}+1}^h p_k\; dt\)
\item \(p_{max} = \max\limits_{k \in [h-\frac{T_p}{dt}+1, h]}\; p_{T_p,h}\)
\item \(p_d = \max(p_{fix}, p_{max})\)
\end{itemize}
\end{itemize}
\end{column}

\begin{column}{0.5\columnwidth}
\begin{itemize}
\item \(\epsilon_{q_i}r_{q_i}\): Assignment Cost
\item \(z_p \phi_i(\eta_i - \nu_{b_i} \kappa_{b_i})\): Penalty Function
\item \(z_c r_{q_i} s_i\): Consumption Cost
\end{itemize}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[label={sec:org8155428}]{Constraints}
\begin{columns}
\begin{column}{0.5\columnwidth}
\begin{equation*}
    \label{seq:c0}
    u_j - d_i - (\sigma_{ij} - 1)T \ge 0
\end{equation*}
\begin{equation*}
    \label{seq:c1}
    q_j - q_i - 1 - (\psi_{ij} - 1)Q \ge 0
\end{equation*}
\begin{equation*}
    \label{seq:c2}
    \sigma_{ij} + \sigma_{ji} \le 1
\end{equation*}
\begin{equation*}
   \label{seq:c3}
    \psi_{ij} + \psi_{ji} \le 1
\end{equation*}
\end{column}

\begin{column}{0.5\columnwidth}
\begin{equation*}
    \label{seq:c4}
    \sigma_{ij} + \sigma_{ji} + \psi_{ij} + \psi_{ji} \ge 1
\end{equation*}
\begin{equation*}
    \label{seq:c5}
    s_i = d_i - u_i
\end{equation*}
\begin{equation*}
    \label{seq:c6}
     \eta_{\xi_i} = \eta_{i} + r_{q_i}s_i - \Delta_i
\end{equation*}
\begin{equation*}
    \label{seq:c7}
    \kappa_{\Xi_i} \geq \eta_{i} + r_{q_i}s_i
\end{equation*}
\begin{equation*}
    \label{seq:c8}
    a_i \leq u_i \leq d_i \le e_i \le \mathcal{T}
\end{equation*}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[label={sec:org887b04f}]{Parameters}
\begin{center}
\begin{tabular}{lrr}
\alert{Model} & \alert{Execution Time} [s] & \alert{Iteration} [s]\\[0pt]
\hline
MILP & 1900 & N/A\\[0pt]
Quick & 1532.8 & 0.4\\[0pt]
Heuristic & 1916 & 0.5\\[0pt]
\end{tabular}
\end{center}

\begin{columns}
\begin{column}{0.5\columnwidth}
\begin{itemize}
\item \(T_0 = 90000\)
\item \(\beta = 0.997\)
\end{itemize}
\end{column}
\begin{column}{0.5\columnwidth}
\begin{itemize}
\item \(|t| = 3797\)
\item \(n_K = 500\)
\end{itemize}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[label={sec:org7e6ea77}]{Schedule}
\begin{columns}
\begin{column}{0.5\columnwidth}
{\scriptsize
\begin{itemize}
\item Qin heavily utilizes fast charger
\item PAP emphasizes slow queues, but utilizes fast chargers readily
\end{itemize}
}

\begin{figure}
\begin{subfigure}[t]{\textwidth}
\centering
    \includegraphics[width=0.7\textwidth]{img/sa-pap-paper-good/schedule-milp}
\end{subfigure}
\begin{subfigure}[t]{\textwidth}
\centering
    \includegraphics[width=0.7\textwidth]{img/sa-pap-paper-good/schedule-qin}
\end{subfigure}
\end{figure}
\end{column}

\begin{column}{0.5\columnwidth}
{\scriptsize
\begin{itemize}
\item SA techniques heavily utilize slow charging
\item SA techniques utilize fast chargers more sparingly
\end{itemize}
}

\begin{figure}
\begin{subfigure}[t]{\textwidth}
\centering
    \includegraphics[width=0.7\textwidth]{img/sa-pap-paper-good/schedule-sa-quick}
\end{subfigure}
\begin{subfigure}[t]{\textwidth}
\centering
    \includegraphics[width=0.7\textwidth]{img/sa-pap-paper-good/schedule-sa-heuristic}
\end{subfigure}
\end{figure}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[label={sec:org5434d7f}]{Power}
\begin{columns}
\begin{column}{0.5\columnwidth}
\begin{figure}[htpb]
\centering
    \includegraphics[width=\textwidth]{img/sa-pap-paper-good/power-milp-qin}
\end{figure}

\begin{itemize}
\item Heuristic SA maintained the lowest demand peak
\end{itemize}
\end{column}

\begin{column}{0.5\columnwidth}
\begin{figure}[htpb]
\centering
    \includegraphics[width=\textwidth]{img/sa-pap-paper-good/power-sa}
\end{figure}


\begin{itemize}
\item Quick SA peak demand comparable to the PAP peak
\end{itemize}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[label={sec:org7131fca}]{Energy and SOC}
\begin{columns}
\begin{column}{0.3\columnwidth}
\begin{itemize}
\item PAP maintained the lowest energy consumption
\item Second lowest consumed energy by the heuristic SA (185 kW difference)
\item Trade off of the lower peak demand
\end{itemize}
\end{column}

\begin{column}{0.7\columnwidth}
\begin{figure}[htpb]
\centering
    \includegraphics[width=\textwidth]{img/sa-pap-paper-good/energy}
\end{figure}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[label={sec:org953bc94}]{Energy}
\begin{figure}[htpb]
\centering
    \includegraphics[width=0.9\textwidth]{img/sa-pap-paper-good/energy-zoom}
\end{figure}
\end{frame}

\section{The Simulated Annealing Approach With Non-Linear Battery Dynamics}
\label{sec:org8cf623f}
\begin{frame}[label={sec:org2cca71f}]{Introduction}
\begin{columns}
\begin{column}{0.3\columnwidth}
\begin{itemize}
\item Higher fidelity in approximating charge at high SOC
\item Implemented in SA for simplicity
\end{itemize}
\end{column}

\begin{column}{0.7\columnwidth}
\begin{center}
\includegraphics[width=.9\linewidth]{./img/nonlinear-bat.png}
\end{center}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[label={sec:org08d24dd}]{Non-Linear Battery Dynamics Model}
\begin{columns}
\begin{column}{0.3\columnwidth}
\begin{equation*}
  \eta_{\xi_i} = \bar{a}_q \eta_i - \bar{b}_q \kappa_{\Xi_i}
\end{equation*}

\begin{equation*}
\begin{array}{cc}
  \bar{a}_q = e^{a_q dt} & \bar{b}_q = e^{a_q dt} - 1
\end{array}
\end{equation*}
\end{column}

\begin{column}{0.7\columnwidth}
\begin{center}
\includegraphics[width=.9\linewidth]{./img/nonlinear-bat.png}
\end{center}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[label={sec:org6d7f298}]{Results}
\begin{columns}
\begin{column}{0.5\columnwidth}
{\scriptsize
\begin{itemize}
\item Minimized demand power
\item Larger energy consumption due to fast charger duration
\end{itemize}
}

\begin{figure}
\begin{subfigure}[t]{\textwidth}
\centering
    \includegraphics[width=0.7\textwidth]{img/sa-nonlinear/power-sa-nonlinear}
\end{subfigure}
\begin{subfigure}[t]{\textwidth}
\centering
    \includegraphics[width=0.7\textwidth]{img/sa-nonlinear/energy-sa-nonlinear}
\end{subfigure}
\end{figure}
\end{column}

\begin{column}{0.5\columnwidth}
{\scriptsize
\begin{itemize}
\item Similar schedule output, longer fast charger durations due to nonlinear model
\item Minimum SOC of 85 kWh
\end{itemize}
}

\begin{figure}
\begin{subfigure}[t]{\textwidth}
\centering
    \includegraphics[width=0.7\textwidth]{img/sa-nonlinear/schedule-sa-nonlinear}
\end{subfigure}
\begin{subfigure}[t]{\textwidth}
\centering
    \includegraphics[width=0.7\textwidth]{img/sa-pap-paper-good/schedule-sa-heuristic}
\end{subfigure}
\end{figure}
\end{column}
\end{columns}
\end{frame}

\appendix
\begin{frame}[label={sec:org58d1a1e}]{Appendix}
\end{frame}

\begin{frame}[label={sec:org57591d7}]{Mixed Integer Linear Programming}
\begin{align*}
\text{max }        &J = \sum_j c_j x_j + \sum_k d_k y_k&         &               \\
\text{subject to } &\sum_j a_{ij} x_j + \sum_k g_{ik} y_k \le b_i&  &(i = 1,2,...,m)\\
                  &x_j \ge 0&                              &(j = 1,2,...,n)\\
                  &y_k \in \mathbb{Z^+}&                   &(k = 1,2,...,n)\\
\end{align*}

\begin{itemize}
\item \(J\): Objective function
\item \(x_j \in \mathbb{R}\) and \(y_k \in \mathbb{Z}^+\): Decision Variables
\item \(c_j, d_k, a_{ij}, g_{ik}, b_i \in \mathbb{R}\): Parameters
\end{itemize}
\end{frame}


\begin{frame}[label={sec:orge5b771b}]{SA Primitive Generators}
\end{frame}
\begin{frame}[label={sec:org688edfb}]{New Visit}
\begin{algorithm}[H]
  \scriptsize
  \caption{New visit algorithm}
  \label{alg:new-visit}
  \LinesNumbered
  \TitleOfAlgo{New Visit}
  \KwIn{$\Sol$}
  \KwOut{$\bar{\Sol}$}

  \SetKwFunction{Union}{Union}
  \SetKwFunction{findFreeTime}{findFreeTime}

  \Begin
    {
      $i \leftarrow \Sol_{i}$\tcc*{Extract visit index}
      $a \leftarrow \I_{i.a}$\tcc*{Extract the arrivial time for visit $i$}
      $e \leftarrow \I_{i.e}$\tcc*{Extract the departure time for visit $i$}
      $q \leftarrow \I_{i.q}$\tcc*{Extract the current charge queue for visit $i$}
      $\bar{q} \leftarrow \mathcal{U}_{Q}$\tcc*{Select a random charging queue with a uniform distribution}
      $C \leftarrow \mathcal{U}_{\C_q}$\tcc*{Select a random time slice from $\C_q$}

      \If(\tcc*[f]{If there is time available in $C_q^j$}){($\bar{C}, \bar{u}, \bar{d}$) $\leftarrow$ \findFreeTime{$C, i, q, a, e$} $\not\in \varnothing$}
         {
           \Return{($i, (\bar{q},\bar{u},\bar{d}),\bar{C}$)}\tcc*[f]{Return visit}
         }

         \Return{($\varnothing$)}\tcc*{Return nothing}
    }
\end{algorithm}
\end{frame}

\begin{frame}[label={sec:org50d6804}]{Slide Visit}
\begin{algorithm}[H]
  \scriptsize
  \caption{Slide Visit Algorithm} \label{alg:slide-visit}
  \LinesNumbered
  \TitleOfAlgo{Slide Visit}
  \KwIn{$\Sol$}
  \KwOut{$\bar{\Sol}$}

    \SetKwFunction{Purge}{Purge}

    \Begin
    {
      $(i, \I, \bar{\C}) \leftarrow$\Purge{$\Sol$}\tcc*{Purge visit $i$ from charger availibility matrix}
      $C \leftarrow \bar{C}_{i.q_i}$\tcc*{Get the time availability of the purged visit}

      \tcc{If there is time available in $C$}
      \If{($\bar{C}, \bar{u}, \bar{d}$) $\leftarrow$ \findFreeTime{$C$, $\Sol_i$, $\I_q$, $\I_{i.a}, \I_{i.e}$} $\not\in \varnothing$}
      {
        \Return{($i, \I, (\I_{i.q_i},\bar{u},\bar{d}),\bar{C}$)}\tcc*[f]{Return updated visit}
      }

        \Return{($\varnothing$)}\tcc*{Return nothing}
    }
  \end{algorithm}
\end{frame}

\begin{frame}[label={sec:org935df93}]{New Charger}
\begin{algorithm}[H]
  \scriptsize
  \caption{New Charger Algorithm} \label{alg:new-charger} \LinesNumbered \TitleOfAlgo{New Charger} \KwIn{$\Sol$}
  \KwOut{$\bar{\Sol}$}

    \SetKwFunction{Purge}{Purge}

    \Begin
    {
      $(i, \I, \bar{\C}) \leftarrow$\Purge{$\Sol$}\tcc*{Purge visit $i$ from charger availibility matrix}
      $q \leftarrow \mathcal{U}_{Q}$\tcc*{Select a random charging queue with a uniform distribution}

      \If(\tcc*[f]{If there is time available in $C_{q}$}){($\bar{C}, \bar{u}, \bar{d}$) $\leftarrow$ \findFreeTime{$\bar{\C}_{i.q}$, $\Sol_i$, $\I_q$, $\I_{i.a}, \I_{i.e}$} $\not\in \varnothing$}
      {
        \tcc{Return visit, note $u$ and $d$ are the original inital/final charge times.}
        \Return{($i, \I, (q,\I_{i.u}, \I_{i.d}),\bar{\C}$)}
      }

      \Return{($\varnothing$)}\tcc*{Return nothing}
    }
  \end{algorithm}
\end{frame}

\begin{frame}[label={sec:org4382409}]{Wait}
\begin{algorithm}[H]
\scriptsize
\caption{Wait algorithm} \label{alg:wait}
    \LinesNumbered
    \TitleOfAlgo{Wait}
    \KwIn{$\Sol$}
    \KwOut{$\bar{\Sol}$}

    \SetKwFunction{Purge}{Purge}

    \Begin
    {
      $(i, \I, \bar{\C}) \leftarrow$\Purge{$\Sol$}\tcc*{Purge visit $i$ from charger availibility matrix}
      $\bar{\C}'_{\I_{i.\Gamma_i}} \leftarrow \C' \cup \{[\I_{i.a}, \I_{i.e}]\}$\tcc*{Update the charger availability matrix for wait queue $\bar{\C}_{i.q_i}$}
      \Return{$(i, \I, (\I_{i.b}, \I_{i.a}, \I_{i.e}), \bar{\C})$}\tcc*[f]{Return visit}
    }
  \end{algorithm}
\end{frame}

\begin{frame}[label={sec:org1ba449f}]{New Window}
\begin{algorithm}[H]
  \scriptsize
  \caption{New window algorithm} \label{alg:new-window}
  \LinesNumbered
  \TitleOfAlgo{New Window}
  \KwIn{$\Sol$}
  \KwOut{$\bar{\Sol}$}

  \SetKwFunction{NewVisit}{NewVisit}
  \SetKwFunction{Wait}{Wait}

  \Begin
  {
    $\bar{\Sol} \leftarrow$\Wait{$\Sol$}\tcc*{Assign visit to its respective idle queue}
    \If(\tcc*[f]{Add visit $i$ back in randomly})
       {
         $\bar{\bar{\Sol}} \leftarrow$ \NewVisit{$\bar{\Sol}$} $\not\in \varnothing$
       }
       {
         \Return{$\bar{\bar{\Sol}}$} \tcc*[f]{Return visit}
       }

       \Return{($\varnothing$)}\tcc*{Return nothing}
  }
\end{algorithm}
\end{frame}

\begin{frame}[label={sec:org4871d98}]{SA Wrapper Functions}
\end{frame}
\begin{frame}[label={sec:orgbcc8c14}]{Charge Schedule Generation}
\begin{algorithm}[H]
\scriptsize
\caption{Charge schedule generation algorithm} \label{alg:charge-schedule-generation}
    \LinesNumbered
    \TitleOfAlgo{Candidate Solution Generator}
    \KwIn{$\Sol$}
    \KwOut{$\bar{\Sol}$}

    \SetKwFunction{NewVisit}{NewVisit}

    \Begin
    {
        \tcc{Select an unscheduled BEB visit from a randomly indexed set of visits}
        \ForEach {$\I_i \in \I$}
        {
            ($i, \bar{\I}$, $\bar{\C}$) $\leftarrow$ \NewVisit{($\I_i$, $\I$, $\C$)}\tcc*{Assign the bus to a charger}
        }
            \Return{($0, \bar{\I}$, $\bar{\C}$)}
    }
  \end{algorithm}
\end{frame}

\begin{frame}[label={sec:org7b2962d}]{Charge Schedule Perturbation}
\begin{center}
\scalebox{0.65}{
\begin{minipage}{1.5\linewidth}
\begin{algorithm}[H]
\scriptsize
\caption{Perturb schedule algorithm} \label{alg:perturb-schedule}

    \LinesNumbered
    \TitleOfAlgo{Perturb Schedule}
    \KwIn{$\Sol$}
    \KwOut{$\bar{\Sol}$}

    \SetKwFunction{PGF}{PGF}

    \Begin
    {
        $p \leftarrow [false; n_A]$\tcc*{Create vector to track priority routes}
        $y^i \leftarrow [1.0; n_V]$\tcc*{Create weight vector for index selection}
        \tcc{Loop through the visits in reverse order}
        \ForEach{$\I_i \leftarrow \I_{|\I|} \text{ TO } \I_{1}$}
        {
            \tcc{If the current visit is part of a priority route}
            \If{$p_{\I_{i.b}} = true$}{$y^i_{\I_i} = y^i_{\I_{i.\xi}}$\;}
            \tcc{Else if the current visit's SOC does below the allowed threshold}
            \ElseIf{$\I_{i.\eta} \le \nu_{\I_{i.b}} \kappa_{\I_{i.b}}$}{
                $p_{\I_{i.b}} = true$\tcc*{Indicate the current BEB's routes are to be prioritized}
                $y^i_{\I_i} = \kappa_{\I_{i.b}} (\nu_{\I_{i.b}}\kappa_{\I_{i.b}} - \I_{i.\eta})$\tcc*{Calculate the weight of the current visit}
            }
        }
        $\I_i\leftarrow\; \W^{y^i}_{\I}$\tcc*{Select an index with a weighted distribution}
        $i \leftarrow\; \I_i$\tcc*{Extract visit index}
        $y^p \leftarrow [y^p_1, y^p_2, ...]$\tcc*{Define the weight of each primitive generator}
        $PGF \leftarrow\; \W^{y^p}_{[1,n_G]}$\tcc*{Select a generator function with weighted distribution}
        $\bar{\Sol} \leftarrow$ \PGF{($i$, $\I$, $\C$)}\tcc*{Excecute the generator function}
        \Return{($0, \bar{\I}$, $\bar{\C}$)}
    }
\end{algorithm}
\end{minipage}}
\end{center}
\end{frame}

\begin{frame}[label={sec:orge8b8e24}]{SA Thesis Results}
\end{frame}
\begin{frame}[label={sec:org0c0179b}]{Parameters}
\begin{center}
\begin{tabular}{lrr}
\alert{Model} & \alert{Execution Time} [s] & \alert{Iteration} [s]\\[0pt]
\hline
MILP & 3600 & N/A\\[0pt]
Quick & 2275.25 & 0.25\\[0pt]
Heuristic & 3640.4 & 0.4\\[0pt]
\end{tabular}
\end{center}

\begin{columns}
\begin{column}{0.5\columnwidth}
\begin{itemize}
\item \(T_0 = 99999\)
\item \(\beta = 0.999\)
\end{itemize}
\end{column}
\begin{column}{0.5\columnwidth}
\begin{itemize}
\item \(|t| = 3797\)
\item \(n_K = 500\)
\end{itemize}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[label={sec:org03dccb4}]{Schedule}
\begin{columns}
\begin{column}{0.5\columnwidth}
\begin{figure}[htpb]
\centering
    \includegraphics[width=\textwidth]{img/sa-pap-paper-bad/schedule-milp}
\end{figure}
\end{column}
\begin{column}{0.5\columnwidth}
\begin{figure}[htpb]
\centering
    \includegraphics[width=\textwidth]{img/sa-pap-paper-bad/schedule-quinn}
\end{figure}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[label={sec:org7b6121d}]{Schedule}
\begin{columns}
\begin{column}{0.5\columnwidth}
\begin{figure}[htpb]
\centering
    \includegraphics[width=\textwidth]{img/sa-pap-paper-bad/schedule-sa-quick}
\end{figure}
\end{column}

\begin{column}{0.5\columnwidth}
\begin{figure}[htpb]
\centering
    \includegraphics[width=\textwidth]{img/sa-pap-paper-bad/schedule-sa-heuristic}
\end{figure}
\end{column}
\end{columns}
\end{frame}

\begin{frame}[label={sec:orgbbbe4d4}]{Power}
\begin{columns}
\begin{column}{0.5\columnwidth}
\begin{figure}[htpb]
\centering
    \includegraphics[width=\textwidth]{img/sa-pap-paper-bad/power-milp-qin}
\end{figure}
\end{column}

\begin{column}{0.5\columnwidth}
\begin{figure}[htpb]
\centering
    \includegraphics[width=\textwidth]{img/sa-pap-paper-bad/power-sa}
\end{figure}
\end{column}
\end{columns}
\end{frame}
\begin{frame}[label={sec:org954eb51}]{Energy}
\begin{figure}[htpb]
\centering
    \includegraphics[width=0.6\textwidth]{img/sa-pap-paper-bad/energy}
\end{figure}
\end{frame}

\begin{frame}[label={sec:orgee99c04}]{What Happened?}
\end{frame}
\begin{frame}[label={sec:orgacf69e6}]{How To Resolve This Problem?}
\begin{figure}[htpb]
\centering
    \includegraphics[width=0.6\textwidth]{img/score-convergence}
\end{figure}

\begin{itemize}
\item Reverse search and weight the visit indices
\item Be more aggressive in exploiting the best solution
\end{itemize}

\begin{figure}[htpb]
\centering
    \includegraphics[width=0.6\textwidth]{img/score-diverge}
\end{figure}

\begin{itemize}
\item Candidate solutions diverge
\item Hard time handling ``difficult'' routes
\end{itemize}
\end{frame}

\begin{frame}[label={sec:org7163903}]{Score Convergence Comparison}
\begin{columns}
\begin{column}{0.5\columnwidth}
\begin{center}
Before Fix
\end{center}

\begin{figure}[htpb]
\centering
    \includegraphics[width=\textwidth]{img/score-diverge}
\end{figure}
\end{column}

\begin{column}{0.5\columnwidth}
\begin{center}
After Fix
\end{center}

\begin{figure}[htpb]
\centering
    \includegraphics[width=\textwidth]{img/score-convergence}
\end{figure}
\end{column}
\end{columns}
\end{frame}


\begin{frame}[label={sec:org9150bd7}]{References}
\bibliographystyle{plain}
\bibliography{/home/alex/Documents/citation-database/lit-ref,/home/alex/Documents/citation-database/lib-ref}
\end{frame}
\end{document}
